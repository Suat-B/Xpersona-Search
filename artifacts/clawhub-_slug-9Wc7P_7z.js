const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SkillDiffCard-BI__biR4.js","assets/main-C9BDiSjk.js","assets/SkillFilesPanel-DSvYIe4X.js","assets/skillDetailUtils-OCVV1cKa.js","assets/index-CEpfy9K4.js"])))=>i.map(i=>d[i]);
import{b as M,a as x,r as d,u as V,j as s,i as bs,_ as Q,C as Ms,P as Hs,f as As,U as Fs,l as qs,L as Us,n as Ws,c as Ys,m as Gs,D as Ks,E as Qs}from"./main-C9BDiSjk.js";import{f as Xs,a as Zs,b as ps,c as Js,d as se,e as ee,s as ne}from"./skillDetailUtils-OCVV1cKa.js";function le({skillId:e,isAuthenticated:n,me:l}){const i=M(x.comments.add),r=M(x.comments.remove),[t,a]=d.useState(""),[o,g]=d.useState(!1),[h,p]=d.useState(null),[j,D]=d.useState(null),[b,N]=d.useState(null),S=V(x.comments.listBySkill,{skillId:e,limit:50}),L=async()=>{const u=t.trim();if(!(!u||o)){g(!0),p(null);try{await i({skillId:e,body:u}),a("")}catch(v){p(v instanceof Error?v.message:"Failed to post comment")}finally{g(!1)}}},w=async u=>{if(!b){D(null),N(u);try{await r({commentId:u})}catch(v){D(v instanceof Error?v.message:"Failed to delete comment")}finally{N(null)}}};return s.jsxs("div",{className:"card",children:[s.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Comments"}),n?s.jsxs("form",{onSubmit:u=>{u.preventDefault(),L()},className:"comment-form",children:[s.jsx("textarea",{className:"comment-input",rows:4,value:t,onChange:u=>a(u.target.value),placeholder:"Leave a note…",disabled:o}),h?s.jsx("div",{className:"report-dialog-error",children:h}):null,s.jsx("button",{className:"btn comment-submit",type:"submit",disabled:o,children:o?"Posting…":"Post comment"})]}):s.jsx("p",{className:"section-subtitle",children:"Sign in to comment."}),j?s.jsx("div",{className:"report-dialog-error",children:j}):null,s.jsx("div",{style:{display:"grid",gap:12,marginTop:16},children:(S??[]).length===0?s.jsx("div",{className:"stat",children:"No comments yet."}):(S??[]).map(u=>s.jsxs("div",{className:"comment-item",children:[s.jsxs("div",{className:"comment-body",children:[s.jsxs("strong",{children:["@",u.user?.handle??u.user?.name??"user"]}),s.jsx("div",{className:"comment-body-text",children:u.comment.body})]}),n&&l&&(l._id===u.comment.userId||bs(l))?s.jsx("button",{className:"btn comment-delete",type:"button",onClick:()=>{w(u.comment._id)},disabled:!!b||o,children:b===u.comment._id?"Deleting…":"Delete"}):null]},u.comment._id))})]})}function xs({className:e}){return s.jsxs("svg",{className:e,width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 89","aria-label":"VirusTotal",children:[s.jsx("title",{children:"VirusTotal"}),s.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M45.292 44.5 0 89h100V0H0l45.292 44.5zM90 80H22l35.987-35.2L22 9h68v71z"})]})}function js({className:e}){return s.jsxs("svg",{className:e,width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none","aria-label":"OpenClaw",children:[s.jsx("title",{children:"OpenClaw"}),s.jsx("path",{d:"M12 2C8.5 2 5.5 4 4 7c-2 4-1 8 2 11 1.5 1.5 3.5 2.5 6 2.5s4.5-1 6-2.5c3-3 4-7 2-11-1.5-3-4.5-5-8-5z",fill:"currentColor",opacity:"0.2"}),s.jsx("path",{d:"M9 8c1-2 3-3 5-2s3 3 2 5l-3 4-2-1 3-4c.5-1 0-2-1-2.5S11 7 10.5 8L8 12l-2-1 3-4z",fill:"currentColor"}),s.jsx("path",{d:"M15 8c-1-2-3-3-5-2s-3 3-2 5l3 4 2-1-3-4c-.5-1 0-2 1-2.5S14 7 14.5 8L17 12l2-1-4-3z",fill:"currentColor",opacity:"0.6"})]})}function vs(e){switch(e.toLowerCase()){case"benign":case"clean":return{label:"Benign",className:"scan-status-clean"};case"malicious":return{label:"Malicious",className:"scan-status-malicious"};case"suspicious":return{label:"Suspicious",className:"scan-status-suspicious"};case"loading":return{label:"Loading...",className:"scan-status-pending"};case"pending":case"not_found":return{label:"Pending",className:"scan-status-pending"};case"error":case"failed":return{label:"Error",className:"scan-status-error"};default:return{label:e,className:"scan-status-unknown"}}}function ae(e){switch(e){case"ok":return{className:"dimension-icon-ok",symbol:"✓"};case"note":return{className:"dimension-icon-note",symbol:"ℹ"};case"concern":return{className:"dimension-icon-concern",symbol:"!"};default:return{className:"dimension-icon-danger",symbol:"✗"}}}function ie({analysis:e}){const n=e.verdict??e.status,[l,i]=d.useState(!1),r=n==="malicious"?"malicious":n==="suspicious"?"suspicious":"benign";return s.jsxs("div",{className:`analysis-detail${l?" is-open":""}`,children:[s.jsxs("button",{type:"button",className:"analysis-detail-header",onClick:()=>{const t=window.getSelection();t&&!t.isCollapsed||i(a=>!a)},"aria-expanded":l,children:[s.jsx("span",{className:"analysis-summary-text",children:e.summary}),s.jsxs("span",{className:"analysis-detail-toggle",children:["Details ",s.jsx("span",{className:"chevron",children:"▾"})]})]}),s.jsxs("div",{className:"analysis-body",children:[e.dimensions&&e.dimensions.length>0?s.jsx("div",{className:"analysis-dimensions",children:e.dimensions.map(t=>{const a=ae(t.rating);return s.jsxs("div",{className:"dimension-row",children:[s.jsx("div",{className:`dimension-icon ${a.className}`,children:a.symbol}),s.jsxs("div",{className:"dimension-content",children:[s.jsx("div",{className:"dimension-label",children:t.label}),s.jsx("div",{className:"dimension-detail",children:t.detail})]})]},t.name)})}):null,e.findings?s.jsxs("div",{className:"scan-findings-section",children:[s.jsx("div",{className:"scan-findings-title",children:"Scan Findings in Context"}),(()=>{const t=new Map;return e.findings.split(`
`).map(a=>{const o=(t.get(a)??0)+1;return t.set(a,o),s.jsx("div",{className:"scan-finding-row",children:a},`${a}-${o}`)})})()]}):null,e.guidance?s.jsxs("div",{className:`analysis-guidance ${r}`,children:[s.jsx("div",{className:"analysis-guidance-label",children:n==="malicious"?"Do not install this skill":n==="suspicious"?"What to consider before installing":"Assessment"}),e.guidance]}):null]})]})}function Ns({sha256hash:e,vtAnalysis:n,llmAnalysis:l,variant:i="panel"}){if(!e&&!l)return null;const r=n?.status??"pending",t=e?`https://www.virustotal.com/gui/file/${e}`:null,a=vs(r),o=n?.source==="code_insight",g=n?.analysis,h=l?.verdict??l?.status,p=h?vs(h):null;return i==="badge"?s.jsxs(s.Fragment,{children:[e?s.jsxs("div",{className:"version-scan-badge",children:[s.jsx(xs,{className:"version-scan-icon version-scan-icon-vt"}),s.jsx("span",{className:a.className,children:a.label}),t?s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"version-scan-link",onClick:j=>j.stopPropagation(),children:"↗"}):null]}):null,p?s.jsxs("div",{className:"version-scan-badge",children:[s.jsx(js,{className:"version-scan-icon version-scan-icon-oc"}),s.jsx("span",{className:p.className,children:p.label})]}):null]}):s.jsxs("div",{className:"scan-results-panel",children:[s.jsx("div",{className:"scan-results-title",children:"Security Scan"}),s.jsxs("div",{className:"scan-results-list",children:[e?s.jsxs("div",{className:"scan-result-row",children:[s.jsxs("div",{className:"scan-result-scanner",children:[s.jsx(xs,{className:"scan-result-icon scan-result-icon-vt"}),s.jsx("span",{className:"scan-result-scanner-name",children:"VirusTotal"})]}),s.jsx("div",{className:`scan-result-status ${a.className}`,children:a.label}),t?s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"scan-result-link",children:"View report →"}):null]}):null,o&&g&&(r==="malicious"||r==="suspicious")?s.jsxs("div",{className:`code-insight-analysis ${r}`,children:[s.jsx("div",{className:"code-insight-label",children:"Code Insight"}),s.jsx("p",{className:"code-insight-text",children:g})]}):null,p&&l?s.jsxs("div",{className:"scan-result-row",children:[s.jsxs("div",{className:"scan-result-scanner",children:[s.jsx(js,{className:"scan-result-icon scan-result-icon-oc"}),s.jsx("span",{className:"scan-result-scanner-name",children:"OpenClaw"})]}),s.jsx("div",{className:`scan-result-status ${p.className}`,children:p.label}),l.confidence?s.jsxs("span",{className:"scan-result-confidence",children:[l.confidence," confidence"]}):null]}):null,l&&l.status!=="error"&&l.status!=="pending"&&l.summary?s.jsx(ie,{analysis:l}):null]})]})}function te({versions:e,nixPlugin:n,skillSlug:l}){return s.jsxs("div",{className:"tab-body",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Versions"}),s.jsx("p",{className:"section-subtitle",style:{margin:0},children:n?"Review release history and changelog.":"Download older releases or scan the changelog."})]}),s.jsx("div",{className:"version-scroll",children:s.jsx("div",{className:"version-list",children:(e??[]).map(i=>s.jsxs("div",{className:"version-row",children:[s.jsxs("div",{className:"version-info",children:[s.jsxs("div",{children:["v",i.version," · ",new Date(i.createdAt).toLocaleDateString(),i.changelogSource==="auto"?s.jsx("span",{style:{color:"var(--ink-soft)"},children:" · auto"}):null]}),s.jsx("div",{style:{color:"#5c554e",whiteSpace:"pre-wrap"},children:i.changelog}),s.jsx("div",{className:"version-scan-results",children:i.sha256hash||i.llmAnalysis?s.jsx(Ns,{sha256hash:i.sha256hash,vtAnalysis:i.vtAnalysis,llmAnalysis:i.llmAnalysis,variant:"badge"}):null})]}),n?null:s.jsx("div",{className:"version-actions",children:s.jsx("a",{className:"btn version-zip",href:`https://wry-manatee-359.convex.site/api/v1/download?slug=${l}&version=${i.version}`,children:"Zip"})})]},i._id))})})]})}const re=d.lazy(()=>Q(()=>import("./SkillDiffCard-BI__biR4.js"),__vite__mapDeps([0,1])).then(e=>({default:e.SkillDiffCard}))),ce=d.lazy(()=>Q(()=>import("./SkillFilesPanel-DSvYIe4X.js"),__vite__mapDeps([2,1,3,4])).then(e=>({default:e.SkillFilesPanel})));function oe({activeTab:e,setActiveTab:n,onCompareIntent:l,readmeContent:i,readmeError:r,latestFiles:t,latestVersionId:a,skill:o,diffVersions:g,versions:h,nixPlugin:p}){return s.jsxs("div",{className:"card tab-card",children:[s.jsxs("div",{className:"tab-header",children:[s.jsx("button",{className:`tab-button${e==="files"?" is-active":""}`,type:"button",onClick:()=>n("files"),children:"Files"}),s.jsx("button",{className:`tab-button${e==="compare"?" is-active":""}`,type:"button",onClick:()=>n("compare"),onMouseEnter:()=>{l(),Q(()=>import("./SkillDiffCard-BI__biR4.js"),__vite__mapDeps([0,1]))},onFocus:()=>{l(),Q(()=>import("./SkillDiffCard-BI__biR4.js"),__vite__mapDeps([0,1]))},children:"Compare"}),s.jsx("button",{className:`tab-button${e==="versions"?" is-active":""}`,type:"button",onClick:()=>n("versions"),children:"Versions"})]}),e==="files"?s.jsx(d.Suspense,{fallback:s.jsx("div",{className:"tab-body stat",children:"Loading file viewer…"}),children:s.jsx(ce,{versionId:a,readmeContent:i,readmeError:r,latestFiles:t})}):null,e==="compare"?s.jsx("div",{className:"tab-body",children:s.jsx(d.Suspense,{fallback:s.jsx("div",{className:"stat",children:"Loading diff viewer…"}),children:s.jsx(re,{skill:o,versions:g??[],variant:"embedded"})})}):null,e==="versions"?s.jsx(te,{versions:h,nixPlugin:p,skillSlug:o.slug}):null]})}function de({clawdis:e,osLabels:n}){const l=e?.requires,i=e?.install??[],r=!!(e?.emoji||n.length||l?.bins?.length||l?.anyBins?.length||l?.env?.length||l?.config?.length||e?.primaryEnv),t=i.length>0;return!r&&!t?null:s.jsx("div",{className:"skill-hero-content",children:s.jsxs("div",{className:"skill-hero-panels",children:[r?s.jsxs("div",{className:"skill-panel",children:[s.jsx("h3",{className:"section-title",style:{fontSize:"1rem",margin:0},children:"Runtime requirements"}),s.jsxs("div",{className:"skill-panel-body",children:[e?.emoji?s.jsxs("div",{className:"tag",children:[e.emoji," Clawdis"]}):null,n.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"OS"}),s.jsx("span",{children:n.join(" · ")})]}):null,l?.bins?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Bins"}),s.jsx("span",{children:l.bins.join(", ")})]}):null,l?.anyBins?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Any bin"}),s.jsx("span",{children:l.anyBins.join(", ")})]}):null,l?.env?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Env"}),s.jsx("span",{children:l.env.join(", ")})]}):null,l?.config?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Config"}),s.jsx("span",{children:l.config.join(", ")})]}):null,e?.primaryEnv?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Primary env"}),s.jsx("span",{children:e.primaryEnv})]}):null]})]}):null,t?s.jsxs("div",{className:"skill-panel",children:[s.jsx("h3",{className:"section-title",style:{fontSize:"1rem",margin:0},children:"Install"}),s.jsx("div",{className:"skill-panel-body",children:i.map((a,o)=>{const g=Xs(a);return s.jsx("div",{className:"stat",children:s.jsxs("div",{children:[s.jsx("strong",{children:a.label??Zs(a)}),a.bins?.length?s.jsxs("div",{style:{color:"var(--ink-soft)",fontSize:"0.85rem"},children:["Bins: ",a.bins.join(", ")]}):null,g?s.jsx("code",{children:g}):null]})},`${a.id??a.kind}-${o}`)})})]}):null]})})}function ue({skill:e,owner:n,ownerHandle:l,latestVersion:i,modInfo:r,canManage:t,isAuthenticated:a,isStaff:o,isStarred:g,onToggleStar:h,onOpenReport:p,forkOf:j,forkOfLabel:D,forkOfHref:b,forkOfOwnerHandle:N,canonical:S,canonicalHref:L,canonicalOwnerHandle:w,staffModerationNote:u,staffVisibilityTag:v,isAutoHidden:C,isRemoved:H,nixPlugin:$,hasPluginBundle:A,configRequirements:_,cliHelp:F,tagEntries:q,versionById:U,tagName:W,onTagNameChange:O,tagVersionId:X,onTagVersionChange:R,onTagSubmit:Z,tagVersions:B,clawdis:J,osLabels:m}){const f=Ms(e.stats);return s.jsxs(s.Fragment,{children:[r?.isPendingScan?s.jsx("div",{className:"pending-banner",children:s.jsxs("div",{className:"pending-banner-content",children:[s.jsx("strong",{children:"Security scan in progress"}),s.jsx("p",{children:"Your skill is being scanned by VirusTotal. It will be visible to others once the scan completes. This usually takes up to 5 minutes — grab a coffee or exfoliate your shell while you wait."})]})}):r?.isMalwareBlocked?s.jsx("div",{className:"pending-banner pending-banner-blocked",children:s.jsxs("div",{className:"pending-banner-content",children:[s.jsx("strong",{children:"Skill blocked — malicious content detected"}),s.jsx("p",{children:"ClawHub Security flagged this skill as malicious. Downloads are disabled. Review the scan results below."})]})}):r?.isSuspicious?s.jsx("div",{className:"pending-banner pending-banner-warning",children:s.jsxs("div",{className:"pending-banner-content",children:[s.jsx("strong",{children:"Skill flagged — suspicious patterns detected"}),s.jsx("p",{children:"ClawHub Security flagged this skill as suspicious. Review the scan results before using."}),t?s.jsxs("p",{className:"pending-banner-appeal",children:["If you believe this skill has been incorrectly flagged, please"," ",s.jsx("a",{href:"https://github.com/openclaw/clawhub/issues",target:"_blank",rel:"noopener noreferrer",children:"submit an issue on GitHub"})," ","and we'll break down why it was flagged and what you can do."]}):null]})}):r?.isRemoved?s.jsx("div",{className:"pending-banner pending-banner-blocked",children:s.jsxs("div",{className:"pending-banner-content",children:[s.jsx("strong",{children:"Skill removed by moderator"}),s.jsx("p",{children:"This skill has been removed and is not visible to others."})]})}):r?.isHiddenByMod?s.jsx("div",{className:"pending-banner pending-banner-blocked",children:s.jsxs("div",{className:"pending-banner-content",children:[s.jsx("strong",{children:"Skill hidden"}),s.jsx("p",{children:"This skill is currently hidden and not visible to others."})]})}):null,s.jsxs("div",{className:"card skill-hero",children:[s.jsxs("div",{className:`skill-hero-top${A?" has-plugin":""}`,children:[s.jsxs("div",{className:"skill-hero-header",children:[s.jsxs("div",{className:"skill-hero-title",children:[s.jsxs("div",{className:"skill-hero-title-row",children:[s.jsx("h1",{className:"section-title",style:{margin:0},children:e.displayName}),$?s.jsx("span",{className:"tag tag-accent",children:"Plugin bundle (nix)"}):null]}),s.jsx("p",{className:"section-subtitle",children:e.summary??"No summary provided."}),o&&u?s.jsx("div",{className:"skill-hero-note",children:u}):null,$?s.jsx("div",{className:"skill-hero-note",children:"Bundles the skill pack, CLI binary, and config requirements in one Nix install."}):null,s.jsxs("div",{className:"stat",children:["⭐ ",f.stars," · ",s.jsx(Hs,{size:14,"aria-hidden":"true"})," ",f.downloads," · ",As(e.stats.installsCurrent??0)," current installs · ",f.installsAllTime," all-time installs"]}),s.jsx("div",{className:"stat",children:s.jsx(Fs,{user:n,fallbackHandle:l,prefix:"by",size:"md",showName:!0})}),j&&b?s.jsxs("div",{className:"stat",children:[D," ",s.jsxs("a",{href:b,children:[N?`@${N}/`:"",j.skill.slug]}),j.version?` (based on ${j.version})`:null]}):null,L?s.jsxs("div",{className:"stat",children:["canonical:"," ",s.jsxs("a",{href:L,children:[w?`@${w}/`:"",S?.skill?.slug]})]}):null,qs(e).map(c=>s.jsx("div",{className:"tag",children:c},c)),o&&v?s.jsx("div",{className:`tag${C||H?" tag-accent":""}`,children:v}):null,s.jsxs("div",{className:"skill-actions",children:[a?s.jsx("button",{className:`star-toggle${g?" is-active":""}`,type:"button",onClick:h,"aria-label":g?"Unstar skill":"Star skill",children:s.jsx("span",{"aria-hidden":"true",children:"★"})}):null,a?s.jsx("button",{className:"btn btn-ghost",type:"button",onClick:p,children:"Report"}):null,o?s.jsx(Us,{className:"btn",to:"/management",search:{skill:e.slug},children:"Manage"}):null]}),s.jsx(Ns,{sha256hash:i?.sha256hash,vtAnalysis:i?.vtAnalysis,llmAnalysis:i?.llmAnalysis}),i?.sha256hash||i?.llmAnalysis?s.jsx("p",{className:"scan-disclaimer",children:"Like a lobster shell, security has layers — review code before you run it."}):null]}),s.jsxs("div",{className:"skill-hero-cta",children:[s.jsxs("div",{className:"skill-version-pill",children:[s.jsx("span",{className:"skill-version-label",children:"Current version"}),s.jsxs("strong",{children:["v",i?.version??"—"]})]}),!$&&!r?.isMalwareBlocked&&!r?.isRemoved?s.jsx("a",{className:"btn btn-primary",href:`https://wry-manatee-359.convex.site/api/v1/download?slug=${e.slug}`,children:"Download zip"}):null]})]}),A?s.jsxs("div",{className:"skill-panel bundle-card",children:[s.jsxs("div",{className:"bundle-header",children:[s.jsx("div",{className:"bundle-title",children:"Plugin bundle (nix)"}),s.jsx("div",{className:"bundle-subtitle",children:"Skill pack · CLI binary · Config"})]}),s.jsxs("div",{className:"bundle-includes",children:[s.jsx("span",{children:"SKILL.md"}),s.jsx("span",{children:"CLI"}),s.jsx("span",{children:"Config"})]}),_?s.jsxs("div",{className:"bundle-section",children:[s.jsx("div",{className:"bundle-section-title",children:"Config requirements"}),s.jsxs("div",{className:"bundle-meta",children:[_.requiredEnv?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"Required env"}),s.jsx("span",{children:_.requiredEnv.join(", ")})]}):null,_.stateDirs?.length?s.jsxs("div",{className:"stat",children:[s.jsx("strong",{children:"State dirs"}),s.jsx("span",{children:_.stateDirs.join(", ")})]}):null]})]}):null,F?s.jsxs("details",{className:"bundle-section bundle-details",children:[s.jsx("summary",{children:"CLI help (from plugin)"}),s.jsx("pre",{className:"hero-install-code mono",children:F})]}):null]}):null]}),s.jsx("div",{className:"skill-tag-row",children:q.length===0?s.jsx("span",{className:"section-subtitle",style:{margin:0},children:"No tags yet."}):q.map(([c,P])=>s.jsxs("span",{className:"tag",children:[c,s.jsxs("span",{className:"tag-meta",children:["v",U.get(P)?.version??P]})]},c))}),t?s.jsxs("form",{onSubmit:c=>{c.preventDefault(),Z()},className:"tag-form",children:[s.jsx("input",{className:"search-input",value:W,onChange:c=>O(c.target.value),placeholder:"latest"}),s.jsx("select",{className:"search-input",value:X??"",onChange:c=>R(c.target.value),children:B.map(c=>s.jsxs("option",{value:c._id,children:["v",c.version]},c._id))}),s.jsx("button",{className:"btn",type:"submit",children:"Update tag"})]}):null,s.jsx(de,{clawdis:J,osLabels:m})]})]})}function me({isOpen:e,isSubmitting:n,reportReason:l,reportError:i,onReasonChange:r,onCancel:t,onSubmit:a}){return e?s.jsx("div",{className:"report-dialog-backdrop",children:s.jsxs("div",{className:"report-dialog",role:"dialog","aria-modal":"true","aria-labelledby":"report-title",children:[s.jsx("h2",{id:"report-title",className:"section-title",style:{margin:0,fontSize:"1.1rem"},children:"Report skill"}),s.jsx("p",{className:"section-subtitle",style:{margin:0},children:"Describe the issue so moderators can review it quickly."}),s.jsxs("form",{className:"report-dialog-form",onSubmit:o=>{o.preventDefault(),a()},children:[s.jsx("textarea",{className:"report-dialog-textarea","aria-label":"Report reason",placeholder:"What should moderators know?",value:l,onChange:o=>r(o.target.value),rows:5,disabled:n}),i?s.jsx("p",{className:"report-dialog-error",children:i}):null,s.jsxs("div",{className:"report-dialog-actions",children:[s.jsx("button",{type:"button",className:"btn btn-ghost",onClick:()=>{n||t()},disabled:n,children:"Cancel"}),s.jsx("button",{type:"submit",className:"btn",disabled:n,children:n?"Submitting…":"Submit report"})]})]})]})}):null}function he(e){if(e&&typeof e=="object"&&"data"in e){const n=e.data;if(typeof n=="string"&&n.trim())return n.trim();if(n&&typeof n=="object"&&"message"in n&&typeof n.message=="string"){const l=n.message?.trim();if(l)return l}}if(e instanceof Error){const n=e.message.replace(/\[CONVEX[^\]]*\]\s*/g,"").replace(/\[Request ID:[^\]]*\]\s*/g,"").replace(/^Server Error Called by client\s*/i,"").replace(/^ConvexError:\s*/i,"").trim();if(n&&n!=="Server Error")return n}return"Unable to submit report. Please try again."}function ge({slug:e,canonicalOwner:n,redirectToCanonical:l}){const i=Ws(),{isAuthenticated:r,me:t}=Ys(),a=bs(t),o=V(x.skills.getBySlugForStaff,a?{slug:e}:"skip"),g=V(x.skills.getBySlug,a?"skip":{slug:e}),h=a?o:g,p=M(x.stars.toggle),j=M(x.skills.report),D=M(x.skills.updateTags),b=Gs(x.skills.getReadme),[N,S]=d.useState(null),[L,w]=d.useState(null),[u,v]=d.useState("latest"),[C,H]=d.useState(""),[$,A]=d.useState("files"),[_,F]=d.useState(!1),[q,U]=d.useState(!1),[W,O]=d.useState(""),[X,R]=d.useState(null),[Z,B]=d.useState(!1),J=h===void 0,m=h?.skill,f=h?.owner,c=h?.latestVersion,P=V(x.skills.listVersions,m?{skillId:m._id,limit:50}:"skip"),fs=!!(m&&($==="compare"||_)),as=V(x.skills.listVersions,fs&&m?{skillId:m._id,limit:200}:"skip"),ks=V(x.stars.isStarred,r&&m?{skillId:m._id}:"skip"),ys=Ks(t,m),is=f?.handle??f?.name??null,z=is??(f?._id?String(f._id):null),ss=!!(z&&(l||typeof n=="string"&&n&&n!==z)),I=h?.forkOf??null,T=h?.canonical??null,Ss=h?.moderationInfo??null,ws=I?.kind==="duplicate"?"duplicate of":"fork of",ts=I?.owner?.handle??null,Cs=I?.owner?.userId??null,rs=T?.owner?.handle??null,_s=T?.owner?.userId??null,Rs=I?.skill?.slug?ps(ts,Cs,I.skill.slug):null,Is=T?.skill?.slug&&T.skill.slug!==I?.skill?.slug?ps(rs,_s,T.skill.slug):null,Y=a&&m?m:null,cs=Y?.moderationStatus??(Y?.softDeletedAt?"hidden":void 0),os=cs==="hidden"||!!Y?.softDeletedAt,es=cs==="removed",ns=os&&Y?.moderationReason==="auto.reports",ds=es?"Removed":ns?"Auto-hidden":os?"Hidden":null,Es=ds?ns?"Auto-hidden after 4+ unique reports.":es?"Removed from public view.":"Hidden from public view.":null,Ds=new Map((as??P??[]).map(k=>[k._id,k])),E=c?.parsed?.clawdis,Ls=d.useMemo(()=>Js(E?.os),[E?.os]),G=E?.nix?.plugin,us=E?.nix?.systems??[],ls=G?se(G):null,K=E?.config,ms=K?.example?ee(K.example):null,hs=E?.cliHelp,$s=!!(ls||K||hs),Bs=d.useMemo(()=>N?ne(N):null,[N]),Ps=c?.files??[];d.useEffect(()=>{!ss||!z||i({to:"/$owner/$slug",params:{owner:z,slug:e},replace:!0})},[i,z,e,ss]),d.useEffect(()=>{if(!c)return;S(null),w(null);let k=!1;return b({versionId:c._id}).then(y=>{k||S(y.text)}).catch(y=>{k||(w(y instanceof Error?y.message:"Failed to load README"),S(null))}),()=>{k=!0}},[c,b]),d.useEffect(()=>{!C&&c&&H(c._id)},[c,C]);const gs=()=>{U(!1),O(""),R(null),B(!1)},Ts=()=>{O(""),R(null),B(!1),U(!0)},Vs=()=>{m&&(!u.trim()||!C||D({skillId:m._id,tags:[{tag:u.trim(),versionId:C}]}))},Os=async()=>{if(!m)return;const k=W.trim();if(!k){R("Report reason required.");return}B(!0),R(null);try{const y=await j({skillId:m._id,reason:k});gs(),y.reported?window.alert("Thanks — your report has been submitted."):window.alert("You have already reported this skill.")}catch(y){console.error("Failed to report skill",y),R(he(y)),B(!1)}};if(J||ss)return s.jsx("main",{className:"section",children:s.jsx("div",{className:"card",children:s.jsx("div",{className:"loading-indicator",children:"Loading skill…"})})});if(h===null||!m)return s.jsx("main",{className:"section",children:s.jsx("div",{className:"card",children:"Skill not found."})});const zs=Object.entries(m.tags??{});return s.jsxs("main",{className:"section",children:[s.jsxs("div",{className:"skill-detail-stack",children:[s.jsx(ue,{skill:m,owner:f,ownerHandle:is,latestVersion:c,modInfo:Ss,canManage:ys,isAuthenticated:r,isStaff:a,isStarred:ks,onToggleStar:()=>{p({skillId:m._id})},onOpenReport:Ts,forkOf:I,forkOfLabel:ws,forkOfHref:Rs,forkOfOwnerHandle:ts,canonical:T,canonicalHref:Is,canonicalOwnerHandle:rs,staffModerationNote:Es,staffVisibilityTag:ds,isAutoHidden:ns,isRemoved:es,nixPlugin:G,hasPluginBundle:$s,configRequirements:K,cliHelp:hs,tagEntries:zs,versionById:Ds,tagName:u,onTagNameChange:v,tagVersionId:C,onTagVersionChange:H,onTagSubmit:Vs,tagVersions:P??[],clawdis:E,osLabels:Ls}),ls?s.jsxs("div",{className:"card",children:[s.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Install via Nix"}),s.jsx("p",{className:"section-subtitle",style:{margin:0},children:us.length?`Systems: ${us.join(", ")}`:"nix-clawdbot"}),s.jsx("pre",{className:"hero-install-code",style:{marginTop:12},children:ls})]}):null,ms?s.jsxs("div",{className:"card",children:[s.jsx("h2",{className:"section-title",style:{fontSize:"1.2rem",margin:0},children:"Config example"}),s.jsx("p",{className:"section-subtitle",style:{margin:0},children:"Starter config for this plugin bundle."}),s.jsx("pre",{className:"hero-install-code",style:{marginTop:12},children:ms})]}):null,s.jsx(oe,{activeTab:$,setActiveTab:A,onCompareIntent:()=>F(!0),readmeContent:Bs,readmeError:L,latestFiles:Ps,latestVersionId:c?._id??null,skill:m,diffVersions:as,versions:P,nixPlugin:!!G}),s.jsx(le,{skillId:m._id,isAuthenticated:r,me:t??null})]}),s.jsx(me,{isOpen:r&&q,isSubmitting:Z,reportReason:W,reportError:X,onReasonChange:O,onCancel:gs,onSubmit:()=>{Os()}})]})}function je(){const{owner:e,slug:n}=Qs.useParams();return s.jsx(ge,{slug:n,canonicalOwner:e})}export{je as component};
